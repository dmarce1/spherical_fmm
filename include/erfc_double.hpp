/*
 * erfc_double.hpp
 *
 *  Created on: Oct 11, 2022
 *      Author: dmarce1
 */

#ifndef ERFC_DOUBLE_HPP_
#define ERFC_DOUBLE_HPP_

#include <stdio.h>

#define List(...) { __VA_ARGS__}

inline double erfc_double(double x) {
	static constexpr int N = 39;
	static constexpr double c0[5][N + 1] =List(List(0.15729920705028513066,-0.41510749742059470334,0.41510749742059470334,
		    -0.13836916580686490111,-0.069184582903432450557,0.069184582903432450557,
		    -0.0046123055268954967038,-0.01515471815979948917,0.0047770307242846215861,
		    0.0018851883701199847638,-0.0012262875805634852347,-0.000085523991371727464132,
		    0.00020005514713217961292,-0.00001871663923714299038,-0.000023707092917618642639,
		    5.4782439136144749702e-6,2.0810470178536989366e-6,-8.4904713963144343778e-7,
		    -1.2328726086225257871e-7,9.7385801574591139527e-8,1.9412656084384987673e-9,
		    -8.9959787718381029827e-9,6.4974130753173241251e-10,6.9020255115771561091e-10,
		    -1.0930785305190424683e-10,-4.4170900677939190423e-11,1.1469726123674405183e-11,
		    2.2964662043673653157e-12,-9.5295626119961216479e-13,-8.6999537449087987462e-14,
		    6.7139682527845269542e-14,1.0941851832004162369e-15,-4.1292544687793769952e-15,
		    1.8601591348811962216e-16,2.2459468423499485974e-16,-2.315083093966012229e-17,
		    -1.0834825684288445954e-17,1.8023015127965290308e-18,4.5998373920471192063e-19,
		    -1.1358237255499409868e-19),List(0.000022090496998585441373,
		    -0.00013925305194674785389,0.00041775915584024356167,-0.00078910062769823783871,
		    0.0010443978896006089042,-0.0010165472792112593334,0.00073804117531776362562,
		    -0.00039057165522206898067,0.00013477706099131667287,-0.000013906885478808813451,
		    -0.000015616235111171009329,0.000010793618593534720017,-3.0307130678020555646e-6,
		    -1.2338633446163999819e-7,4.5253432810580908467e-7,-1.6573732792802534838e-7,
		    9.3558263606651124303e-9,1.4977795982415109037e-8,-5.9709857312013879724e-9,
		    3.9655378820946255485e-10,4.4670619596676640987e-10,-1.6350901778088463397e-10,
		    5.917507363032050835e-12,1.2028197183551233037e-11,-3.4787346654048557896e-12,
		    -8.7265464375095810005e-14,2.77029359377996076e-13,-5.5346590946171791105e-14,
		    -7.1949457068465155992e-15,5.1692940761619351482e-15,-5.7073587318249637038e-16,
		    -2.1192107445649773325e-16,7.425551637082496029e-17,-1.0586671656207698049e-18,
		    -4.0487851594829634913e-18,7.5279344997100450365e-19,9.3040290754706802889e-20,
		    -5.4648832057798036546e-20,3.8642530458693273864e-21,2.1342536287576572607e-21),
		   List(1.5374597944280348502e-12,-1.5670866531017335308e-11,7.8354332655086676541e-11,
		    -2.5595748667328314337e-10,6.1377560579817896624e-10,-1.1507639655943729895e-9,
		    1.7542664477777739248e-9,-2.232103505017207276e-9,2.4142151424619861111e-9,
		    -2.2484411434266387087e-9,1.8192473403222856223e-9,-1.2859344859140824134e-9,
		    7.9596853518260115928e-10,-4.3093375340898926936e-10,2.0284694010322075381e-10,
		    -8.1877590599129450144e-11,2.7508017779080151729e-11,-7.1505703186725763687e-12,
		    1.0958836119077553182e-12,1.3409456342535567037e-13,-1.7086783441972833901e-13,
		    6.9233270175671791258e-14,-1.6675916363857018623e-14,1.5037633451982783876e-15,
		    7.0267164966323331565e-16,-3.9635718299716133598e-16,1.0055547163916174591e-16,
		    -9.012198684222203901e-18,-3.6978715350481689606e-18,1.8744615255683329059e-18,
		    -3.8679659362312538038e-19,7.8711931225530167407e-21,2.093520740866541092e-20,
		    -6.8061366897454720951e-21,8.0763978026864482396e-22,1.4672898843013606566e-22,
		    -8.4344961118107516674e-23,1.508495256186875481e-23,3.4950551394900563364e-25,
		    -8.428465485012887967e-25),List(4.1838256077794143986e-23,-5.91596295800306936e-22,
		    4.141174070602148552e-21,-1.9128280230876590931e-20,6.5568589451200685407e-20,
		    -1.7785356639409894186e-19,3.9750669773257734823e-19,-7.5266730822846447221e-19,
		    1.231987782742831966e-18,-1.7700734632222038553e-18,2.259082798245693048e-18,
		    -2.5855479037854305211e-18,2.6741872819548669643e-18,-2.5152654454175524265e-18,
		    2.1626253642806468928e-18,-1.7070365229435734662e-18,1.2413506650762179787e-18,
		    -8.3401269591457949725e-19,5.1886209263147367655e-19,-2.9940589380712182335e-19,
		    1.6042876952095092804e-19,-7.9863408336180072771e-20,3.6932232186144814444e-20,
		    -1.5851510599235256507e-20,6.3028409361655448543e-21,-2.3143084449780021196e-21,
		    7.8072552431746859822e-22,-2.3998385840834538999e-22,6.6291231764346812579e-23,
		    -1.6043145932972043684e-23,3.2197796206703772773e-24,-4.535537382464300245e-25,
		    3.685025361620961693e-27,2.5065757963326203296e-26,-1.0531391980570808798e-26,
		    2.8223550900606517397e-27,-5.2922169797690821761e-28,5.1924083690777867792e-29,
		    7.971043316155374219e-30,-5.4541006999407701087e-30),
		   List(4.1370317465138102381e-37,-7.4920734282459744915e-36,6.7428660854213770423e-35,
		    -4.0207460731586729771e-34,1.7868595126366649162e-33,-6.3120718632972335091e-33,
		    1.845971971985525655e-32,-4.5964976455033223149e-32,9.9465542798141482825e-32,
		    -1.8999345128558206115e-31,3.2430544914993366868e-31,-4.995918065804325751e-31,
		    7.002505206055073977e-31,-8.9912238914115436699e-31,1.0636737723324062875e-30,
		    -1.1650886119528398615e-30,1.1866294150081641107e-30,-1.1279287248667870148e-30,
		    1.0038367598986129901e-30,-8.3886998117450248627e-31,6.5988265843507837542e-31,
		    -4.8971594702856457303e-31,3.4354398623245513764e-31,-2.2821215172500498505e-31,
		    1.4377517286218122782e-31,-8.6021859495186768509e-32,4.8936351500691302914e-32,
		    -2.6497321264336454898e-32,1.3667999810094668424e-32,-6.7214489606078132036e-33,
		    3.1530900782436517937e-33,-1.4116393575659341966e-33,6.0333604518868162707e-34,
		    -2.4621204721552338732e-34,9.5932664130075996376e-35,-3.5681340614606694302e-35,
		    1.266335192568019814e-35,-4.2854040576713962415e-36,1.3814493341110779735e-36,
		    -4.2361096104203374629e-37));
	double x1 = x;
	double del = 0.25;
	int j = int(x+del) / 2;
	j += j < 0;
	double x0 = 2*j + 1;
	x -= x0;
	double y = c0[j][N];
	for (int n = N - 1; n >= 0; n--) {
		y = fma(y, x, c0[j][n]);
	}
//	printf( "%e %e\n", erfc(x1), y);
	return y;
}


#endif /* ERFC_DOUBLE_HPP_ */
